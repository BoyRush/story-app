const CACHE_NAME="dicoding-story-v1",APP_SHELL=["/","/index.html","/app.bundle.js","/manifest.webmanifest","/favicon.png","/images/logo.png"];self.addEventListener("install",(t=>{t.waitUntil(caches.open(CACHE_NAME).then((t=>t.addAll(APP_SHELL)))),self.skipWaiting()})),self.addEventListener("activate",(t=>{t.waitUntil(caches.keys().then((t=>Promise.all(t.filter((t=>t!==CACHE_NAME)).map((t=>caches.delete(t))))))),self.clients.claim()})),self.addEventListener("fetch",(t=>{const e=new URL(t.request.url);e.origin!==location.origin?e.host.includes("story-api.dicoding.dev")&&e.pathname.includes("/v1/stories")&&t.respondWith(fetch(t.request).then((e=>{const i=e.clone();return caches.open(CACHE_NAME).then((e=>e.put(t.request,i))),e})).catch((()=>caches.match(t.request)))):t.respondWith(caches.match(t.request).then((e=>e||fetch(t.request))))})),self.addEventListener("push",(t=>{let e={};try{e=t.data?t.data.json():{}}catch(i){e={title:"Notifikasi",options:{body:t.data?.text?.()||""}}}const i=e.title||"Dicoding Story",n={body:e.options?.body||"Ada story baru.",icon:"/images/logo.png",badge:"/favicon.png",data:e.data||{},actions:[{action:"open_detail",title:"Lihat detail"},{action:"close",title:"Tutup"}]};t.waitUntil(self.registration.showNotification(i,n))})),self.addEventListener("notificationclick",(t=>{t.notification.close();const e=t.action,i=t.notification.data?.storyId;let n="/#/";"open_detail"===e&&i&&(n=`/#/stories/${i}`),t.waitUntil(clients.matchAll({type:"window",includeUncontrolled:!0}).then((t=>{for(const e of t)if("focus"in e)return e.navigate(n),e.focus();return clients.openWindow(n)})))}));